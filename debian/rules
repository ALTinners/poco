#!/usr/bin/make -f

# These are used for cross-compiling and for saving the configure script
# from having to guess our platform (since we know it already)
DEB_HOST_GNU_TYPE   ?= $(shell dpkg-architecture -qDEB_HOST_GNU_TYPE)
DEB_BUILD_GNU_TYPE  ?= $(shell dpkg-architecture -qDEB_BUILD_GNU_TYPE)
DEB_HOST_ARCH_OS    ?= $(shell dpkg-architecture -qDEB_HOST_ARCH_OS)

CONFFLAGS := --prefix=/usr --no-samples --unbundled

# On ARM define POCO_NO_FPENVIRONMENT
ifeq ($(shell dpkg --print-architecture),arm)
CONFFLAGS += --no-fpenvironment
endif

ifeq ($(DEB_HOST_ARCH_OS),linux)
	CONFFLAGS += --config=Linux
else ifeq ($(DEB_HOST_ARCH_OS),kfreebsd)
	CONFFLAGS += --config=FreeBSD
endif

POCO_LIBS := $(shell dh_listpackages | grep dbg | sed -e 's/-dbg//')


%:
	dh $@ --parallel

override_dh_auto_configure:
	./configure $(CONFFLAGS)

override_dh_auto_test:
	./debian/testrunner.sh

override_dh_strip-%:
	dh_strip -p$* --dbg-package=$*-dbg

override_dh_strip: $(POCO_LIBS:%=override_dh_strip-%)
